gene_counts = as.integer(table(sym)[rownames(gene_sum)])
gene_expr_pre   = sweep(gene_sum, 1, gene_counts, "/")   # rows = genes, cols = samples
## 4) Quick checks
dim(expr_filtered)   # probes_kept x samples
dim(gene_expr_pre)       # genes x samples
plot_2D = function(u1,u2) {
ggplot(data.frame(u1, u2), aes(u1, u2)) + stat_bin2d(bins = 200)
}
plot_2D = function(u1,u2) {
ggplot(data.frame(u1, u2), aes(u1, u2)) + stat_bin2d(bins = 200)
}
head(gene_expr_pre)
m_pre = nrow(gene_expr_pre)
m_pre #
X1_pre = gene_expr_pre[, 2:4] # all FATPAD
X2_pre = gene_expr_pre[, 5:7] # all MIND
X1_pre = gene_expr_pre[, 1:3] # all FATPAD
X2_pre = gene_expr_pre[, 4:6] # all MIND
info_pre = information_extractor(X1_pre, X2_pre)
filter_out_idx = c(which(info_pre$S1_list == 0), which(info_pre$S2_list == 0))
filter_out_idx
#filter_out_idx = c( 6459 29233 43617  5336  8453 16380 41500 43905 44521 54034)
#length(filter_out_idx) = 10
expr = expr_pre[-filter_out_idx, ]
X1_pre = gene_expr_pre[, 1:3] # all FATPAD
X2_pre = gene_expr_pre[, 4:6] # all MIND
info_pre = information_extractor(X1_pre, X2_pre)
filter_out_idx = c(which(info_pre$S1_list == 0), which(info_pre$S2_list == 0))
filter_out_idx
#filter_out_idx = c( 6459 29233 43617  5336  8453 16380 41500 43905 44521 54034)
#length(filter_out_idx) = 10
expr = gene_expr_pre[-filter_out_idx, ]
write.csv(expr, "GSE68694_gene_expression_matrix.csv", row.names = FALSE)
X1_pre = gene_expr_pre[, 1:3] # all FATPAD
X2_pre = gene_expr_pre[, 4:6] # all MIND
info_pre = information_extractor(X1_pre, X2_pre)
filter_out_idx = c(which(info_pre$S1_list == 0), which(info_pre$S2_list == 0))
filter_out_idx
gene_expr_pre[8988, ]
#filter_out_idx = c( 6459 29233 43617  5336  8453 16380 41500 43905 44521 54034)
#length(filter_out_idx) = 10
expr = gene_expr_pre[-filter_out_idx, ]
write.csv(expr, "GSE68694_gene_expression_matrix.csv", row.names = FALSE)
X1_pre = gene_expr_pre[, 1:3] # all FATPAD
X2_pre = gene_expr_pre[, 4:6] # all MIND
info_pre = information_extractor(X1_pre, X2_pre)
filter_out_idx = c(which(info_pre$S1_list == 0), which(info_pre$S2_list == 0))
filter_out_idx
#filter_out_idx = c( 6459 29233 43617  5336  8453 16380 41500 43905 44521 54034)
#length(filter_out_idx) = 10
expr = gene_expr_pre[-filter_out_idx, ]
write.csv(expr, "GSE68694_gene_expression_matrix.csv", row.names = FALSE)
X1_pre = gene_expr_pre[, 1:3] # all FATPAD
X2_pre = gene_expr_pre[, 4:6] # all MIND
info_pre = information_extractor(X1_pre, X2_pre)
filter_out_idx = c(which(info_pre$S1_list == 0), which(info_pre$S2_list == 0))
filter_out_idx
#filter_out_idx = c(8988)
#length(filter_out_idx) = 1
expr = gene_expr_pre[-filter_out_idx, ]
write.csv(expr, "GSE68694_gene_expression_matrix.csv", row.names = FALSE)
X1_pre = gene_expr_pre[, 1:3] # all FATPAD
X2_pre = gene_expr_pre[, 4:6] # all MIND
info_pre = information_extractor(X1_pre, X2_pre)
filter_out_idx = c(which(info_pre$S1_list == 0), which(info_pre$S2_list == 0))
filter_out_idx
#filter_out_idx = c(8988)
#length(filter_out_idx) = 1
expr = gene_expr_pre[-filter_out_idx, ]
write.csv(expr, "GSE68694_gene_expression_matrix.csv", row.names = TRUE)
expr = read.csv("GSE68694_gene_expression_matrix.csv.csv")
expr = read.csv("GSE68694_gene_expression_matrix.csv")
head(expr)
m = nrow(expr)
m # 54665
X1 = expr[, 2:4] # filtered FATPAD
X2 = expr[, 5:7] # filtered MIND
info = information_extractor(X1, X2)
hist(info$S1_list, breaks = 100)
hist(info$S2_list, breaks = 100)
plot_2D(log(info$S1_list), log(info$S2_list))
source('EPB.R')
alpha = 0.1
NPMLE_1D_parameter = c(1000, 0, 1.0)
NPMLE_2D_parameter = c(80, 80, 0.01, 1.0)
EVD_NPMLE_1D_parameter = c(80, 0.01, 1.0)
EV_NPMLE_1D_parameter = c(1000, 0.01, 1.0)
algorithm_list = c(1,2,3,4,5)
result = solver(X1, X2, NPMLE_1D_parameter, NPMLE_2D_parameter, EVD_NPMLE_1D_parameter, EV_NPMLE_1D_parameter, alpha, algorithm_list)
hist(result$`1D_NPMLE`, breaks = 50, main = '1D_NPMLE')
hist(result$`2D_NPMLE`,breaks = 50, main = '2D_NPMLE')
hist(result$`Welch`,breaks = 50, main = 'Welch')
hist(result$`Pooled_t`,breaks = 50, main = 'Pooled_t')
hist(result$`B_F`,breaks = 50, main = 'B_F')
source('helper.R')
cutoff_1DNPMLE = cutoff_pvalue(result$`1D_NPMLE`, 0.1)
cutoff_2DNPMLE = cutoff_pvalue(result$`2D_NPMLE`, 0.1)
cutoff_Welch = cutoff_pvalue(result$Welch, 0.05)
cutoff_pooled_t = cutoff_pvalue(result$`Pooled_t`, 0.1)
cutoff_B_F = cutoff_pvalue(result$`B_F`, 0.1)
length(my_BH(result$`1D_NPMLE`, 0.1)) # 12595
length(my_BH(result$`2D_NPMLE`, 0.1)) # 17280
length(my_BH(result$Welch, 0.1)) # 7793
length(my_BH(result$`Pooled_t`, 0.1)) # 12785
length(my_BH(result$`B_F`, 0.1)) # 0
length(my_BH(result$`1D_NPMLE`, 0.1)) # 6805
length(my_BH(result$`2D_NPMLE`, 0.1)) # 8303
length(my_BH(result$Welch, 0.1)) # 4970
length(my_BH(result$`Pooled_t`, 0.1)) # 6869
length(my_BH(result$`B_F`, 0.1)) # 0
df_GSE68694 = data.frame(x = result$grid[,1], y = result$grid[,2], prob = result$mass)
write.csv(df_GSE68694, './Result/2D_GSE68694.csv')
Total_mass = 0.9999999
threshold_ALL = find_threshold(df_ALL$prob, Total_mass = Total_mass)
Total_mass = 0.9999999
threshold_ALL = find_threshold(df_GSE68694$prob, Total_mass = Total_mass)
size_breaks = exp(seq(log(min(df_GSE68694$prob[df_GSE68694$prob > threshold_ALL])), log(max(df_GSE68694$prob)), length.out = 10))
plot_H = ggplot(df_GSE68694, aes(x = log(x), y = log(y))) +
geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "grey50", linewidth = 1) +
geom_point(aes(size = ifelse(prob < threshold_ALL, NA, prob)), color = "blue", alpha = 0.8) +
scale_size_continuous(range = c(0.2, 5), breaks = size_breaks) +  # Adjust the range of point sizes
theme_minimal() +
labs(title = expression(paste(hat(H)({sigma[A]}^2, {sigma[B]}^2), ' of GSE68694 (Threshold = 0.9999999)')),
x = expression(log({sigma[A]}^2)),
y = expression(log({sigma[B]}^2))) +
theme(plot.title = element_text(hjust = 0.5), legend.position = 'none')
plot_H
ggsave(filename = 'H(var1, var2) of GSE68694.jpg', plot = plot_H, width = 8, height = 6, dpi = 500)
Total_mass = 0.999999
threshold_ALL = find_threshold(df_GSE68694$prob, Total_mass = Total_mass)
size_breaks = exp(seq(log(min(df_GSE68694$prob[df_GSE68694$prob > threshold_ALL])), log(max(df_GSE68694$prob)), length.out = 10))
plot_H = ggplot(df_GSE68694, aes(x = log(x), y = log(y))) +
geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "grey50", linewidth = 1) +
geom_point(aes(size = ifelse(prob < threshold_ALL, NA, prob)), color = "blue", alpha = 0.8) +
scale_size_continuous(range = c(0.2, 5), breaks = size_breaks) +  # Adjust the range of point sizes
theme_minimal() +
labs(title = expression(paste(hat(H)({sigma[A]}^2, {sigma[B]}^2), ' of GSE68694 (Threshold = 0.9999999)')),
x = expression(log({sigma[A]}^2)),
y = expression(log({sigma[B]}^2))) +
theme(plot.title = element_text(hjust = 0.5), legend.position = 'none')
plot_H
ggsave(filename = 'H(var1, var2) of GSE68694.jpg', plot = plot_H, width = 8, height = 6, dpi = 500)
lambda_projection_list_GSE68694 = result$grid[,1] / result$grid[,2]
df_1D_GSE68694 = data.frame(x = lambda_projection_list_GSE68694, prob = result$mass)
plot_1D_ALL = ggplot(df_1D_ALL, aes(x = log(x), y = 0)) +
geom_segment(aes(xend = log(x), yend = prob), size = 1, color = "blue") +
scale_y_continuous(name = "Density", limits = c(0, max(df_1D_ALL$prob))) +
theme_minimal() +
labs(title = expression(paste(hat(G)({sigma[A]}^2/{sigma[B]}^2), ' of GSE68694')),
x = expression(log({sigma[A]}^2/{sigma[B]}^2))) +
theme(plot.title = element_text(hjust = 0.5))
df_1D_GSE68694 = data.frame(x = lambda_projection_list_GSE68694, prob = result$mass)
plot_1D_ALL = ggplot(df_1D_GSE68694, aes(x = log(x), y = 0)) +
geom_segment(aes(xend = log(x), yend = prob), size = 1, color = "blue") +
scale_y_continuous(name = "Density", limits = c(0, max(df_1D_GSE68694$prob))) +
theme_minimal() +
labs(title = expression(paste(hat(G)({sigma[A]}^2/{sigma[B]}^2), ' of GSE68694')),
x = expression(log({sigma[A]}^2/{sigma[B]}^2))) +
theme(plot.title = element_text(hjust = 0.5))
plot_1D_ALL
ggsave(filename = 'G(lambda) of GSE68694.jpg', plot = plot_1D_ALL, width = 8, height = 6, dpi = 500)
library(Equalden.HD)
source('EPB.R')
source('helper.R')
expr = read.csv("GSE68694_gene_expression_matrix.csv", header = TRUE, stringsAsFactors = FALSE)
m = nrow(expr)
m
head(expr)
X1 = expr[, 2:4]
X2 = expr[, 5:7]
info = information_extractor(X1, X2)
tau_list = info$S1_list/info$S2_list
log_tau_list = log(tau_list)
log_tau_list = log_tau_list[log_tau_list >= -7.5 & log_tau_list <= 7.5]
tau_grid = exp(seq(min(log_tau_list), max(log_tau_list), length.out = 1000))
X1_1 = as.numeric(X1[1, ])
X2_1 = as.numeric(X2[1, ])
K1 = length(X1_1)
K2 = length(X2_1)
m1 = mean(X1_1)
m2 = mean(X2_1)
sd1 = sqrt(var(X1_1))
sd2 = sqrt(var(X2_1))
se = sqrt(sd1^2/K1 + sd2^2/K2)
md = m1 - m2
t = md / se
t_BF_list = c()
D = c()
for (i in 1:nrow(expr)) {
X1_i = as.numeric(X1[i,])
X2_i = as.numeric(X2[i,])
m1_i = mean(X1_i)
m2_i = mean(X2_i)
s1_i = var(X1_i)
s2_i = var(X2_i)
t_BF_i = (m1_i - m2_i) / sqrt(s1_i/K1 + s2_i/K2)
t_BF_list = c(t_BF_list, t_BF_i)
Di = s1_i/K1 + s2_i/K2
D = c(D, Di)
}
max(t_BF_list)
D = D[log(tau_list) >= -5]
t_BF_list = t_BF_list[log(tau_list) >= -7.5 & log(tau_list) <= 7.5]
result_csv = read.csv('./Result/2D_GSE68694.csv')
grid = result_csv[, 2:3]
mass = result_csv[, 4]
grid_1D = grid[, 1] / grid[, 2]
bfresult = bfTest(X1_1, X2_1)
bfresult
t_BF_005 = c()
for (tau in tau_grid) {
t_BF_005_i = BF_pvalue_BF_solver_positive(tau, K1, K2, 0.05)
t_BF_005 = append(t_BF_005, t_BF_005_i)
}
p_value_npmle_j(K1, K2, m1, m2, sd1^2, sd2^2, grid_1D, mass, sd1^2/sd2^2)
BF_pvalue_1DNPMLE(t, K1, K2, grid_1D, mass, sd1^2/sd2^2)
BF_pvalue_1DNPMLE_solver_positive(K1, K2, grid_1D, mass, sd1^2/sd2^2, 0.05)
t_1DNPMLE_005 = c()
#t_1DNPMLE_bh = c()
for (tau in tau_grid) {
t_1DNPMLE_005_i = BF_pvalue_1DNPMLE_solver_positive(K1, K2, grid_1D, mass, tau, 0.05)
#t_1DNPMLE_bh_i = BF_pvalue_1DNPMLE_solver_positive(K1, K2, grid_1D, mass, tau, cutoff_1DNPMLE)
t_1DNPMLE_005 = append(t_1DNPMLE_005, t_1DNPMLE_005_i)
#t_1DNPMLE_bh = append(t_1DNPMLE_bh, t_1DNPMLE_bh_i)
}
Welch_approximation_p(K1, K2, m1, m2, sd1^2, sd2^2)
BF_pvalue_Welch(t, sd1^2/sd2^2, K1, K2)
BF_pvalue_Welch_solver_positive(sd1^2/sd2^2, K1, K2, 0.05)
t_Welch_005 = c()
#t_Welch_bh = c()
for (tau in tau_grid) {
t_Welch_005_i = BF_pvalue_Welch_solver_positive(tau, K1, K2, 0.05)
#t_Welch_bh_i = BF_pvalue_Welch_solver_positive(tau, K1, K2, cutoff_Welch)
t_Welch_005 = append(t_Welch_005, t_Welch_005_i)
#t_Welch_bh = append(t_Welch_bh, t_Welch_bh_i)
}
t.test(X1_1, X2_1, var.equal = TRUE)$p.value
BF_pvalue_t(t, sd1^2/sd2^2, K1, K2)
BF_pvalue_t_solver_positive(sd1^2/sd2^2, K1, K2, 0.05)
t_t_005 = c()
#t_t_bh = c()
for (tau in tau_grid) {
t_t_005_i = BF_pvalue_t_solver_positive(tau, K1, K2, 0.05)
#t_t_bh_i = BF_pvalue_t_solver_positive(tau, K1, K2, cutoff_pooled_t)
t_t_005 = append(t_t_005, t_t_005_i)
#t_t_bh = append(t_t_bh, t_t_bh_i)
}
library(ggplot2)
# Define color palette consistent with previous figures
curve_colors = c(
"VREPB"   = "#0072B2",   # blue
"B-F"     = "#CC79A7",   # magenta
"Welch"   = "#E69F00",   # gold
"EV-test"  = "#D55E00"     # orange
)
size = 1
plot_2D <- function(u1, u2) {
ggplot(data.frame(u1 = u1, u2 = u2), aes(x = u1, y = u2)) +
stat_bin2d(bins = 80) +
scale_fill_gradient(low = "lightblue", high = "darkblue") +
labs(x = expression(log(hat(lambda)[i])), y = expression(T[i]^{BF}), fill = "Count") +
scale_y_continuous(limits = c(-10, 10)) +
theme_minimal(base_size = 16) +
theme(
# Explicit axis lines
#axis.line = element_line(size = 0.6, colour = "black"),
# Explicit major grid (light gray, behind lines)
panel.grid.major = element_line(colour = "gray80", size = 0.5),
panel.grid.minor = element_line(colour = "gray90", size = 0.25),
# Other formatting
#axis.ticks = element_line(size = 1.1),
#axis.title = element_text(size = 20, face = "bold"),
#axis.text = element_text(size = 16, face = "bold"),
legend.position = "top",
legend.text = element_text(size = 9),
legend.title = element_text(size = 9),
plot.margin = margin(12, 12, 12, 12)
)
}
# Combine all lines in one call for clarity
p <- plot_2D(log_tau_list, t_BF_list) +
geom_line(data = data.frame(x = log(tau_grid), y = t_1DNPMLE_005), aes(x = x, y = y, color = "VREPB"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_1DNPMLE_005), aes(x = x, y = y, color = "VREPB"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_BF_005), aes(x = x, y = y, color = "B-F"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_BF_005), aes(x = x, y = y, color = "B-F"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_t_005), aes(x = x, y = y, color = "EV-test"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_t_005), aes(x = x, y = y, color = "EV-test"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_Welch_005), aes(x = x, y = y, color = "Welch"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_Welch_005), aes(x = x, y = y, color = "Welch"), size = size) +
scale_color_manual(
name = NULL,
values = curve_colors,
breaks = c("VREPB", "B-F", "Welch", "EV-test"),
labels = c("VREPB", "B-F", "Welch", "EV-test")
) +
guides(fill = guide_colorbar(barwidth = 10, barheight = 0.7),
color = guide_legend(override.aes = list(size = 1)))
# Save as high-res PNG
ggsave("2D_publishable_plot.pdf", p, width = 7, height = 5.5, dpi = 400)
length(tau_grid)
length(t_BF_list)
length(log_tau_list)
library(ggplot2)
# Define color palette consistent with previous figures
curve_colors = c(
"VREPB"   = "#0072B2",   # blue
"B-F"     = "#CC79A7",   # magenta
"Welch"   = "#E69F00",   # gold
"EV-test"  = "#D55E00"     # orange
)
size = 1
plot_2D <- function(u1, u2) {
ggplot(data.frame(u1 = u1, u2 = u2), aes(x = u1, y = u2)) +
stat_bin2d(bins = 80) +
scale_fill_gradient(low = "lightblue", high = "darkblue") +
labs(x = expression(log(hat(lambda)[i])), y = expression(T[i]^{BF}), fill = "Count") +
scale_y_continuous(limits = c(-10, 10)) +
theme_minimal(base_size = 16) +
theme(
# Explicit axis lines
#axis.line = element_line(size = 0.6, colour = "black"),
# Explicit major grid (light gray, behind lines)
panel.grid.major = element_line(colour = "gray80", size = 0.5),
panel.grid.minor = element_line(colour = "gray90", size = 0.25),
# Other formatting
#axis.ticks = element_line(size = 1.1),
#axis.title = element_text(size = 20, face = "bold"),
#axis.text = element_text(size = 16, face = "bold"),
legend.position = "top",
legend.text = element_text(size = 9),
legend.title = element_text(size = 9),
plot.margin = margin(12, 12, 12, 12)
)
}
# Combine all lines in one call for clarity
p <- plot_2D(log_tau_list, t_BF_list) +
geom_line(data = data.frame(x = log(tau_grid), y = t_1DNPMLE_005), aes(x = x, y = y, color = "VREPB"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_1DNPMLE_005), aes(x = x, y = y, color = "VREPB"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_BF_005), aes(x = x, y = y, color = "B-F"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_BF_005), aes(x = x, y = y, color = "B-F"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_t_005), aes(x = x, y = y, color = "EV-test"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_t_005), aes(x = x, y = y, color = "EV-test"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_Welch_005), aes(x = x, y = y, color = "Welch"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_Welch_005), aes(x = x, y = y, color = "Welch"), size = size) +
scale_color_manual(
name = NULL,
values = curve_colors,
breaks = c("VREPB", "B-F", "Welch", "EV-test"),
labels = c("VREPB", "B-F", "Welch", "EV-test")
) +
guides(fill = guide_colorbar(barwidth = 10, barheight = 0.7),
color = guide_legend(override.aes = list(size = 1)))
# Save as high-res PNG
ggsave("2D_publishable_plot.pdf", p, width = 7, height = 5.5, dpi = 400)
library(ggplot2)
# Define color palette consistent with previous figures
curve_colors = c(
"VREPB"   = "#0072B2",   # blue
"B-F"     = "#CC79A7",   # magenta
"Welch"   = "#E69F00",   # gold
"EV-test"  = "#D55E00"     # orange
)
size = 1
plot_2D <- function(u1, u2) {
ggplot(data.frame(u1 = u1, u2 = u2), aes(x = u1, y = u2)) +
stat_bin2d(bins = 80) +
scale_fill_gradient(low = "lightblue", high = "darkblue") +
labs(x = expression(log(hat(lambda)[i])), y = expression(T[i]^{BF}), fill = "Count") +
scale_y_continuous(limits = c(-12, 12)) +
theme_minimal(base_size = 16) +
theme(
# Explicit axis lines
#axis.line = element_line(size = 0.6, colour = "black"),
# Explicit major grid (light gray, behind lines)
panel.grid.major = element_line(colour = "gray80", size = 0.5),
panel.grid.minor = element_line(colour = "gray90", size = 0.25),
# Other formatting
#axis.ticks = element_line(size = 1.1),
#axis.title = element_text(size = 20, face = "bold"),
#axis.text = element_text(size = 16, face = "bold"),
legend.position = "top",
legend.text = element_text(size = 9),
legend.title = element_text(size = 9),
plot.margin = margin(12, 12, 12, 12)
)
}
# Combine all lines in one call for clarity
p <- plot_2D(log_tau_list, t_BF_list) +
geom_line(data = data.frame(x = log(tau_grid), y = t_1DNPMLE_005), aes(x = x, y = y, color = "VREPB"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_1DNPMLE_005), aes(x = x, y = y, color = "VREPB"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_BF_005), aes(x = x, y = y, color = "B-F"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_BF_005), aes(x = x, y = y, color = "B-F"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_t_005), aes(x = x, y = y, color = "EV-test"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_t_005), aes(x = x, y = y, color = "EV-test"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_Welch_005), aes(x = x, y = y, color = "Welch"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_Welch_005), aes(x = x, y = y, color = "Welch"), size = size) +
scale_color_manual(
name = NULL,
values = curve_colors,
breaks = c("VREPB", "B-F", "Welch", "EV-test"),
labels = c("VREPB", "B-F", "Welch", "EV-test")
) +
guides(fill = guide_colorbar(barwidth = 10, barheight = 0.7),
color = guide_legend(override.aes = list(size = 1)))
# Save as high-res PNG
ggsave("2D_publishable_plot.pdf", p, width = 7, height = 5.5, dpi = 400)
library(ggplot2)
# Define color palette consistent with previous figures
curve_colors = c(
"VREPB"   = "#0072B2",   # blue
"B-F"     = "#CC79A7",   # magenta
"Welch"   = "#E69F00",   # gold
"EV-test"  = "#D55E00"     # orange
)
size = 1
plot_2D <- function(u1, u2) {
ggplot(data.frame(u1 = u1, u2 = u2), aes(x = u1, y = u2)) +
stat_bin2d(bins = 80) +
scale_fill_gradient(low = "lightblue", high = "darkblue") +
labs(x = expression(log(hat(lambda)[i])), y = expression(T[i]^{BF}), fill = "Count") +
scale_y_continuous(limits = c(-12, 12)) +
theme_minimal(base_size = 16) +
theme(
# Explicit axis lines
#axis.line = element_line(size = 0.6, colour = "black"),
# Explicit major grid (light gray, behind lines)
panel.grid.major = element_line(colour = "gray80", size = 0.5),
panel.grid.minor = element_line(colour = "gray90", size = 0.25),
# Other formatting
#axis.ticks = element_line(size = 1.1),
#axis.title = element_text(size = 20, face = "bold"),
#axis.text = element_text(size = 16, face = "bold"),
legend.position = "top",
legend.text = element_text(size = 9),
legend.title = element_text(size = 9),
plot.margin = margin(12, 12, 12, 12)
)
}
# Combine all lines in one call for clarity
p <- plot_2D(log_tau_list, t_BF_list) +
geom_line(data = data.frame(x = log(tau_grid), y = t_1DNPMLE_005), aes(x = x, y = y, color = "VREPB"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_1DNPMLE_005), aes(x = x, y = y, color = "VREPB"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_BF_005), aes(x = x, y = y, color = "B-F"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_BF_005), aes(x = x, y = y, color = "B-F"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_t_005), aes(x = x, y = y, color = "EV-test"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_t_005), aes(x = x, y = y, color = "EV-test"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = t_Welch_005), aes(x = x, y = y, color = "Welch"), size = size) +
geom_line(data = data.frame(x = log(tau_grid), y = -t_Welch_005), aes(x = x, y = y, color = "Welch"), size = size) +
scale_color_manual(
name = NULL,
values = curve_colors,
breaks = c("VREPB", "B-F", "Welch", "EV-test"),
labels = c("VREPB", "B-F", "Welch", "EV-test")
) +
guides(fill = guide_colorbar(barwidth = 10, barheight = 0.7),
color = guide_legend(override.aes = list(size = 1)))
# Save as high-res PNG
ggsave("2D_publishable_plot.jpg", p, width = 7, height = 5.5, dpi = 400)
m = 5000
ones_arr = array(1, dim = c(m))
m = 5000
ones_arr = array(1, dim = c(m))
ones_arr
m = 5
ones_arr = array(1, dim = c(m))
ones_arr
m = 5
ones_arr = array(1, dim = c(m))
ones_arr[1]
m = 5
k = 2
d1 = 3
d2 = 5
ones_arr = array(1, dim = c(m))
ones_arr
lambda = k * rf(m, d1, d2)
m = 5
k = 2
d1 = 3
d2 = 5
ones_arr = array(1, dim = c(m))
ones_arr
lambda = k * rf(m, d1, d2)
lambda
gset = getGEO("GSE68694", GSEMatrix = TRUE)
library(GEOquery)
library(REBayes)
library(ggplot2)
library(AnnotationDbi)
library(hgu133plus2.db)
library(matrixStats)
library(Biobase)
gset = getGEO("GSE68694", GSEMatrix = TRUE)
eset = gset[[1]]
group_assignment = pData(eset)$title
X = exprs(eset)   # expression matrix (genes x samples)
dim(X)
## 1) drop obvious Affy control probes
keep_ctrl = !grepl("^AFFX", rownames(X))
X = X[keep_ctrl, , drop=FALSE]
dim(X)
head(X)
## 2) Remove low-expression probes (simple, robust rule)
## keep probes expressed above a global cutoff in at least half the samples
cutoff = quantile(X, 0.05)                         # 20th percentile of all intensities
min_samples = ceiling(0.5 * ncol(X))               # expressed in >= half of samples
keep_expr = rowSums(X > cutoff) >= min_samples
## Final keep mask
expr_filtered = X[keep_expr, , drop=FALSE]              # probe-level filtered matrix
dim(expr_filtered)
head(expr_filtered)
ls
